# Анализ результатов клинических исследований с использованием Python

## Цель задания
Провести полный цикл анализа данных клинического исследования, используя библиотеки **Python** (Pandas, NumPy, SciPy, Statsmodels, Matplotlib/Seaborn) для статистической обработки, визуализации и формирования отчетов. Задание фокусируется на оценке эффективности и безопасности терапии в соответствии с протоколом исследования.

## Набор данных
*   **Рекомендуемый подход**: Создание синтетического датасета, имитирующего данные клинического исследования.
*   **Таблицы для генерации**:
    *   `patients`: Patient_ID, Group (Treatment/Placebo), Sex, Age, Baseline_Severity_Score.
    *   `visits`: Visit_ID, Patient_ID, Visit_Number, Visit_Date, Severity_Score.
    *   `labs`: Lab_ID, Patient_ID, Visit_Number, Parameter_Name (например, ALT, Creatinine), Parameter_Value.
    *   `adverse_events`: AE_ID, Patient_ID, Start_Date, End_Date, AE_Term, Severity_Grade, Relatedness.
*   **Описание**: Данные должны отражать рандомизированное контролируемое исследование с несколькими визитами, оценкой основного показателя эффективности, лабораторными данными и записями о нежелательных явлениях (НЯ).

## Гипотезы для проверки
1.  Терапевтическая группа демонстрирует статистически значимо большее улучшение по основному показателю эффективности (`Severity_Score`) по сравнению с группой плацебо через 12 недель.
2.  Профиль безопасности в терапевтической группе сопоставим (не хуже) с группой плацебо, что оценивается по доле пациентов с хотя бы одним НЯ.
3.  Лабораторные показатели безопасности (например, печеночные ферменты) не демонстрируют клинически значимых негативных трендов в терапевтической группе.
4.  Время до первого НЯ в терапевтической группе не отличается статистически значимо от такового в группе плацебо.
5.  Эффективность терапии может различаться в подгруппах пациентов (например, в зависимости от исходной тяжести состояния `Baseline_Severity_Score`).

## Этапы выполнения

### Этап 1. Создание синтетических данных и расчет показателей
**Требования**:
1.  Сгенерируйте реалистичный синтетический датасет:
    *   Создайте 300 пациентов (200 в группе лечения, 100 в плацебо) с 5 визитами каждому.
    *   Имитируйте основной показатель эффективности (`Severity_Score`), который в группе лечения в среднем снижается (улучшается) сильнее.
    *   Сгенерируйте лабораторные данные и записи о НЯ, возможные небольшие различия в частоте НЯ между группами.
2.  Рассчитайте ключевые производные показатели:
    *   `Score_Change = Visit_Score - Baseline_Score`.
    *   Бинарный показатель ответа: `Response = 1`, если улучшение (`-Score_Change`) > 50% от исходного уровня.
    *   Z-скор для лабораторных параметров в рамках каждой группы для выявления выбросов.
3.  Обеспечьте согласованность данных между таблицами.

### Этап 2. Статистический анализ эффективности и безопасности (Гипотезы 1, 2, 5)
Для проверки гипотез сформируйте следующие визуализации и расчеты. К каждому приложите краткий вывод.

| № гипотезы | Анализ и визуализация | Метод и библиотеки | Проверяемая гипотеза |
| :--- | :--- | :--- | :--- |
| 1 | Сравнение улучшения между группами | **Диаграмма "ящик с усами":** Распределение `Score_Change` на 12-й неделе по группам. Используйте Seaborn `boxplot`. Проведите **t-тест** или **ANCOVA** с ковариатой `Baseline_Severity_Score` (statsmodels). | Значимое превосходство терапии |
| 2 | Сравнение долей пациентов с НЯ | **Столбчатая диаграмма с доверительными интервалами:** Доля пациентов с ≥1 НЯ в каждой группе. Рассчитайте **95% доверительный интервал для разницы долей**. Используйте пропорции из `scipy.stats`. | Сопоставимый профиль безопасности |
| 5 | Анализ эффекта в подгруппах | **Диаграмма рассеяния с регрессией:** `Baseline_Severity_Score` vs. `Score_Change`, цвет точек — группа. Добавьте линии регрессии для каждой группы. Используйте Seaborn `lmplot`. | Влияние исходной тяжести на эффект |

### Этап 3. Анализ динамики и выживаемости (Гипотезы 3, 4)
**Требования**:
1.  **Анализ трендов лабораторных параметров (Гипотеза 3)**:
    *   Для ключевого параметра безопасности (например, АЛТ) рассчитайте индивидуальный угловой коэффициент (slope) линейного тренда по визитам для каждого пациента.
    *   Сравните средние значения `slope` между группами с помощью t-теста.
    *   Постройте график среднего значения параметра по визитам для каждой группы с доверительными интервалами.
2.  **Анализ выживаемости до первого НЯ (Гипотеза 4)**:
    *   Используйте библиотеку `lifelines`.
    *   Рассчитайте и постройте **кривые Каплана-Майера** для времени до первого НЯ в каждой группе.
    *   Проведите **log-rank тест** для сравнения кривых.
    *   Визуализируйте кривые с аннотацией p-value.

### Этап 4. Создание комплексного аналитического отчета
Создайте структурированный отчет, объединяющий все этапы анализа.
*   Используйте Jupyter Notebook для последовательного выполнения всех шагов.
*   Организуйте отчет в соответствии со стандартной структурой отчета клинического исследования:
    *   **Введение и цели**
    *   **Методы** (описание синтетической популяции, анализируемых показателей)
    *   **Результаты**:
        *   Демография и исходные характеристики (сводная таблица).
        *   Эффективность (гипотезы 1, 5).
        *   Безопасность (гипотезы 2, 3, 4).
    *   **Выводы и обсуждение**
*   **Расширенная задача**:
    *   Сгенерируйте из ноутбука готовый **PDF-отчет** с помощью `nbconvert` или связки `Jinja2`/`WeasyPrint`.
    *   Добавьте в отчет интерактивные элементы для выбора подгруппы анализа с помощью `ipywidgets`.

### Этап 5. Заключение
На основе проведенного анализа:
1.  Подведите итоги по каждой проверенной гипотезе, указав p-value и клиническую интерпретацию.
2.  Сформулируйте общие выводы об эффективности и безопасности исследуемой терапии на основе синтетических данных.
3.  Дайте рекомендации по дальнейшему анализу (например, анализ других подгрупп, многофакторные модели) и оформлению результатов для регуляторных органов.